const { getCityFromArgs } = require('../../utils/city-util.js');

    determineCategory(title, description = '', genre = '') {
        const combined = `${title} ${description} ${genre}`.toLowerCase();
        
        if (combined.includes('indie rock') || combined.includes('indie') || combined.includes('alternative rock')) {
            return 'Indie Rock';
        } else if (combined.includes('electronic') || combined.includes('edm') || combined.includes('house') || combined.includes('techno')) {
            return 'Electronic';
        } else if (combined.includes('punk') || combined.includes('hardcore') || combined.includes('ska')) {
            return 'Punk';
        } else if (combined.includes('hip hop') || combined.includes('rap') || combined.includes('hip-hop')) {
            return 'Hip Hop';
        } else if (combined.includes('metal') || combined.includes('metalcore') || combined.includes('death metal')) {
            return 'Metal';
        } else if (combined.includes('pop') || combined.includes('pop rock') || combined.includes('synth pop')) {
            return 'Pop';
        } else if (combined.includes('rock') || combined.includes('garage rock') || combined.includes('classic rock')) {
            return 'Rock';
        } else if (combined.includes('folk') || combined.includes('acoustic') || combined.includes('singer-songwriter')) {
            return 'Folk';
        } else if (combined.includes('jazz') || combined.includes('blues') || combined.includes('soul')) {
            return 'Jazz/Blues';
        } else if (combined.includes('experimental') || combined.includes('avant-garde') || combined.includes('noise')) {
            return 'Experimental';
        } else if (combined.includes('tribute') || combined.includes('cover') || combined.includes('covers')) {
            return 'Tribute Act';
        } else if (combined.includes('dj') || combined.includes('dance party') || combined.includes('club night')) {
            return 'DJ/Dance Party';
        }
        
        return 'Live Music';
    }

    /**
     * Main scrape method that handles the scraping process
     * @returns {Promise<Array>} Array of formatted events
     */
    async scrape() {
        try {
            const events = await this.fetchEvents();
            
            // Filter out events with invalid dates or titles
            const validEvents = events.filter(event => {
                return event.title && 
                       event.title.length >= 3 && 
                       event.startDate && 
                       !isNaN(event.startDate.getTime());
            });
            
            console.log(`🗽 ${this.venueName}: Returning ${validEvents.length} valid events`);
            return validEvents;
            
        } catch (error) {
            console.error(`❌ ${this.venueName} scraper failed:`, error.message);
            return [];
        }
    }
}

// Function export for compatibility with runner/validator
module.exports = async (city) => {
  const scraper = new WebsterHall();
  return await scraper.scrape(city);
};

// Also export the class for backward compatibility
module.exports.WebsterHall = WebsterHall;
